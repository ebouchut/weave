<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>weave — Entity-Level Semantic Merge for Git</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #0a0a0a;
      --fg: #e0e0e0;
      --dim: #666;
      --dim2: #444;
      --border: #222;
      --accent: #fff;
      --green: #4ade80;
      --yellow: #facc15;
      --red: #f87171;
      --blue: #60a5fa;
      --cyan: #22d3ee;
      --purple: #a78bfa;
      --orange: #fb923c;
      --surface: #111;
      --surface2: #141414;
      --mono: 'SF Mono', 'Cascadia Code', 'Fira Code', 'JetBrains Mono', monospace;
    }

    body {
      font-family: var(--mono);
      background: var(--bg);
      color: var(--fg);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    a { color: var(--fg); text-decoration-color: var(--dim); text-underline-offset: 3px; }
    a:hover { color: var(--accent); text-decoration-color: var(--accent); }

    .container { max-width: 800px; margin: 0 auto; padding: 0 24px; }

    /* Nav */
    nav {
      padding: 20px 0;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      background: var(--bg);
      z-index: 50;
    }
    nav .logo { font-size: 18px; font-weight: 700; letter-spacing: -0.5px; color: var(--accent); }
    nav .links { display: flex; gap: 20px; font-size: 13px; color: var(--dim); }

    /* Install box */
    .install-box:hover { border-color: #444 !important; }
    .install-box .copied.show { opacity: 1 !important; }

    /* Terminal */
    .terminal {
      background: #0d0d0d; border: 1px solid var(--border);
      border-radius: 10px; margin: 24px 0; overflow: hidden;
    }
    .terminal-bar {
      background: var(--surface2); padding: 10px 16px;
      display: flex; align-items: center; gap: 8px;
      border-bottom: 1px solid var(--border);
    }
    .terminal-dot { width: 10px; height: 10px; border-radius: 50%; background: #333; }
    .terminal-title { font-size: 12px; color: var(--dim); margin-left: 8px; }
    .terminal-body {
      padding: 20px 24px; font-size: 13px; line-height: 1.7; overflow-x: auto;
    }
    .terminal-body .cmd { color: var(--accent); }
    .terminal-body .g { color: var(--green); }
    .terminal-body .y { color: var(--yellow); }
    .terminal-body .r { color: var(--red); }
    .terminal-body .d { color: var(--dim2); }
    .terminal-body .b { color: var(--blue); }
    .terminal-body .c { color: var(--cyan); }
    .terminal-body .p { color: var(--purple); }
    .terminal-body .o { color: var(--orange); }
    .terminal-body .w { color: var(--accent); font-weight: 600; }

    /* Sections */
    section { padding: 60px 0; border-top: 1px solid var(--border); }
    section h2 {
      font-size: 22px; font-weight: 600; color: var(--accent);
      margin-bottom: 12px; letter-spacing: -0.5px;
    }
    section .section-desc {
      font-size: 14px; color: var(--dim); margin-bottom: 32px; line-height: 1.7;
    }

    /* Tables */
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th {
      text-align: left; padding: 10px 16px; color: var(--dim);
      font-weight: 400; border-bottom: 1px solid var(--border);
    }
    td { padding: 10px 16px; border-bottom: 1px solid #181818; color: var(--fg); }
    tr:last-child td { border-bottom: none; }
    td.win { color: var(--green); font-weight: 600; }
    td.lose { color: var(--dim); }

    /* Comparison table */
    .comparison-table { overflow-x: auto; }
    .comparison-table table { min-width: 640px; }
    .comparison-table th:first-child { width: 200px; }

    /* Phase cards */
    .phase-cards { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }
    .phase-card {
      padding: 20px; border: 1px solid var(--border); border-radius: 8px;
      transition: border-color 0.2s;
    }
    .phase-card:hover { border-color: #444; }
    .phase-card h3 { font-size: 14px; color: var(--accent); margin-bottom: 8px; }
    .phase-card p { font-size: 12px; color: var(--dim); line-height: 1.6; }
    .phase-card .tag {
      display: inline-block; font-size: 10px; padding: 2px 8px;
      border-radius: 4px; margin-bottom: 10px; font-weight: 600;
    }

    /* Architecture diagram */
    .arch-layer {
      padding: 16px 20px; border: 1px solid var(--border); border-radius: 8px;
      margin-bottom: 8px; display: flex; align-items: center; gap: 16px;
    }
    .arch-layer .label { min-width: 140px; font-size: 13px; font-weight: 600; }
    .arch-layer .desc { font-size: 12px; color: var(--dim); }
    .arch-arrow { text-align: center; color: var(--dim2); font-size: 16px; margin: 4px 0; }

    /* Flow steps */
    .flow { display: flex; flex-direction: column; gap: 0; }
    .flow-step {
      display: flex; align-items: flex-start; gap: 16px; padding: 12px 0;
    }
    .flow-num {
      width: 28px; height: 28px; border-radius: 50%; background: var(--surface);
      border: 1px solid var(--border); display: flex; align-items: center;
      justify-content: center; font-size: 12px; color: var(--dim);
      flex-shrink: 0;
    }
    .flow-content { flex: 1; }
    .flow-content .title { font-size: 13px; color: var(--fg); font-weight: 600; }
    .flow-content .desc { font-size: 12px; color: var(--dim); margin-top: 2px; }
    .flow-connector {
      width: 28px; display: flex; justify-content: center;
    }
    .flow-connector .line {
      width: 1px; height: 12px; background: var(--border);
    }

    /* MCP tool cards */
    .tool-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
    .tool-card {
      padding: 14px; border: 1px solid var(--border); border-radius: 6px;
    }
    .tool-card:hover { border-color: #444; }
    .tool-card .tool-name {
      font-size: 12px; font-weight: 600; color: var(--cyan); margin-bottom: 4px;
    }
    .tool-card .tool-desc { font-size: 11px; color: var(--dim); line-height: 1.5; }

    /* Command docs */
    .cmd-doc { margin-bottom: 28px; }
    .cmd-doc-header {
      display: flex; align-items: baseline; gap: 12px; margin-bottom: 6px;
    }
    .cmd-doc-name {
      font-size: 14px; font-weight: 600; color: var(--accent);
      background: var(--surface); padding: 4px 10px; border-radius: 4px;
    }
    .cmd-doc-desc { font-size: 13px; color: var(--dim); }
    .cmd-doc-flags { margin-top: 8px; padding-left: 16px; }
    .cmd-doc-flags .flag {
      font-size: 12px; color: var(--fg); margin-bottom: 2px;
    }
    .cmd-doc-flags .flag code {
      color: var(--cyan); background: none; padding: 0;
    }
    .cmd-doc-flags .flag span { color: var(--dim); }

    /* Concept boxes */
    .concept-box {
      padding: 20px; border: 1px solid var(--border); border-radius: 8px;
      margin-bottom: 16px;
    }
    .concept-box h4 { font-size: 14px; color: var(--accent); margin-bottom: 8px; }
    .concept-box p { font-size: 13px; color: var(--dim); line-height: 1.7; }
    .concept-box code { color: var(--cyan); font-size: 12px; }

    /* State diagram */
    .state-doc {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 8px; padding: 20px 24px; font-size: 13px;
      line-height: 1.7; overflow-x: auto;
    }

    /* Footer */
    footer {
      padding: 40px 0; border-top: 1px solid var(--border);
      text-align: center; font-size: 12px; color: var(--dim);
    }

    @media (max-width: 640px) {
      .phase-cards { grid-template-columns: 1fr; }
      .tool-grid { grid-template-columns: 1fr; }
      nav .links { gap: 12px; font-size: 12px; }
      .arch-layer { flex-direction: column; gap: 8px; }
      .arch-layer .label { min-width: auto; }
    }
  </style>
</head>
<body>
  <div class="container">
    <nav>
      <div class="logo">weave</div>
      <div class="links">
        <a href="#how-it-works">How It Works</a>
        <a href="#architecture">Architecture</a>
        <a href="#crdt">CRDT</a>
        <a href="#mcp">MCP</a>
        <a href="#commands">Commands</a>
        <a href="https://github.com/Ataraxy-Labs/weave">GitHub</a>
      </div>
    </nav>

    <!-- Header -->
    <div style="padding: 48px 0 32px; text-align: center;">
      <h1 style="font-size: 36px; font-weight: 700; color: var(--accent); letter-spacing: -1.5px; margin-bottom: 12px;">Merge without conflicts.</h1>
      <p style="font-size: 14px; color: var(--dim); margin-bottom: 24px; line-height: 1.7; max-width: 540px; margin-left: auto; margin-right: auto;">
        Entity-level semantic merge driver for Git. Understands functions, classes, and properties &mdash; so two agents editing different functions in the same file merge cleanly.
      </p>
      <div class="install-box" onclick="copyCmd(this, 'cargo install --git https://github.com/Ataraxy-Labs/weave weave-cli')" style="display: inline-block; background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 10px 20px; font-size: 14px; color: var(--fg); cursor: pointer; position: relative;">
        <span class="copied" style="position: absolute; top: -28px; left: 50%; transform: translateX(-50%); font-size: 12px; color: var(--green); opacity: 0; transition: opacity 0.2s;">copied</span>
        <span style="color: var(--dim);">$</span> cargo install --git https://github.com/Ataraxy-Labs/weave weave-cli
      </div>
    </div>

    <!-- Terminal demo: the problem -->
    <div class="terminal">
      <div class="terminal-bar">
        <div class="terminal-dot"></div>
        <div class="terminal-dot"></div>
        <div class="terminal-dot"></div>
        <div class="terminal-title">the problem</div>
      </div>
      <div class="terminal-body">
<pre><span class="d"># Two agents edit different functions in the same file</span>
<span class="d"># Agent 1 modifies processData()</span>
<span class="d"># Agent 2 modifies validateInput()</span>

<span class="cmd">$ git merge feature-b</span>
<span class="r">CONFLICT (content): Merge conflict in src/lib.ts</span>
<span class="r">Automatic merge failed; fix conflicts and then commit.</span>

<span class="d"># Git sees overlapping line ranges &mdash; false conflict.</span>
<span class="d"># The functions don't actually overlap. Git doesn't know that.</span></pre>
      </div>
    </div>

    <div class="terminal">
      <div class="terminal-bar">
        <div class="terminal-dot"></div>
        <div class="terminal-dot"></div>
        <div class="terminal-dot"></div>
        <div class="terminal-title">the solution</div>
      </div>
      <div class="terminal-body">
<pre><span class="cmd">$ weave setup</span>
<span class="g">&#10003;</span> Merge driver configured for *.ts, *.js, *.py, *.go, *.rs, ...

<span class="cmd">$ git merge feature-b</span>
<span class="d">weave [src/lib.ts]: 2 entities matched, 2 modified, 0 conflicts</span>
<span class="g">Merge made by the 'ort' strategy.</span>

<span class="d"># weave understands functions. Different functions = no conflict.</span></pre>
      </div>
    </div>

    <!-- ═══ Three Phases ═══ -->
    <section>
      <h2>Three phases</h2>
      <p class="section-desc">weave has three layers, each building on the last. Use just the merge driver, or add coordination for multi-agent workflows.</p>

      <div class="phase-cards">
        <div class="phase-card" style="border-color: var(--green);">
          <div class="tag" style="background: #4ade8022; color: var(--green);">PHASE 1</div>
          <h3>Merge Driver</h3>
          <p>Replaces git's line-level merge with entity-level merge. Parses code with tree-sitter, merges by function/class instead of by line.</p>
        </div>
        <div class="phase-card" style="border-color: var(--purple);">
          <div class="tag" style="background: #a78bfa22; color: var(--purple);">PHASE 2</div>
          <h3>CRDT State</h3>
          <p>Persistent "who's editing what" state. Agents claim entities before editing, detect conflicts before they happen.</p>
        </div>
        <div class="phase-card" style="border-color: var(--cyan);">
          <div class="tag" style="background: #22d3ee22; color: var(--cyan);">PHASE 3</div>
          <h3>MCP Server</h3>
          <p>9 tools exposed via Model Context Protocol. Claude and other AI agents call them directly to coordinate work.</p>
        </div>
      </div>
    </section>

    <!-- ═══ How It Works ═══ -->
    <section id="how-it-works">
      <h2>How the merge driver works</h2>
      <p class="section-desc">When git encounters a merge, it calls weave-driver with three versions of the file: base, ours, theirs. Here's what happens inside.</p>

      <div class="flow">
        <div class="flow-step">
          <div class="flow-num">1</div>
          <div class="flow-content">
            <div class="title">Parse all three versions</div>
            <div class="desc">tree-sitter extracts entities (functions, classes, methods) from base, ours, and theirs. Each entity gets a stable ID based on its type, name, and parent.</div>
          </div>
        </div>
        <div class="flow-connector"><div class="line"></div></div>
        <div class="flow-step">
          <div class="flow-num">2</div>
          <div class="flow-content">
            <div class="title">Extract regions</div>
            <div class="desc">The file is split into alternating <code style="color:var(--cyan)">Entity</code> and <code style="color:var(--cyan)">Interstitial</code> regions. Interstitials are the whitespace, imports, and syntax between entities.</div>
          </div>
        </div>
        <div class="flow-connector"><div class="line"></div></div>
        <div class="flow-step">
          <div class="flow-num">3</div>
          <div class="flow-content">
            <div class="title">Match entities across versions</div>
            <div class="desc">For each entity in base: did ours change it? Did theirs? Both? Neither? This is where weave understands that two agents editing <em>different</em> functions is not a conflict.</div>
          </div>
        </div>
        <div class="flow-connector"><div class="line"></div></div>
        <div class="flow-step">
          <div class="flow-num">4</div>
          <div class="flow-content">
            <div class="title">Resolve per-entity</div>
            <div class="desc">
              <span style="color:var(--green)">Only ours changed?</span> Use ours.
              <span style="color:var(--green)">Only theirs?</span> Use theirs.
              <span style="color:var(--yellow)">Both changed identically?</span> Use either.
              <span style="color:var(--red)">Both changed differently?</span> Attempt 3-way merge on the entity body via <code style="color:var(--cyan)">diffy</code>.
            </div>
          </div>
        </div>
        <div class="flow-connector"><div class="line"></div></div>
        <div class="flow-step">
          <div class="flow-num">5</div>
          <div class="flow-content">
            <div class="title">Reconstruct the file</div>
            <div class="desc">Reassemble the merged file preserving ours-side ordering, with theirs-only additions placed at the correct positions. Write to the ours path per git convention.</div>
          </div>
        </div>
      </div>
    </section>

    <!-- ═══ weave vs git ═══ -->
    <section>
      <h2>weave vs git merge</h2>
      <p class="section-desc">git merges lines. weave merges entities.</p>
      <div class="comparison-table">
        <table>
          <thead>
            <tr>
              <th>Scenario</th>
              <th>git merge</th>
              <th>weave merge</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Two agents edit different functions</td>
              <td class="lose">CONFLICT (adjacent lines)</td>
              <td class="win">auto-resolved</td>
            </tr>
            <tr>
              <td>One adds function, one modifies another</td>
              <td class="lose">often conflicts</td>
              <td class="win">auto-resolved</td>
            </tr>
            <tr>
              <td>Both modify the same function identically</td>
              <td class="lose">CONFLICT</td>
              <td class="win">detected as identical, uses either</td>
            </tr>
            <tr>
              <td>Both modify the same function differently</td>
              <td class="lose">CONFLICT</td>
              <td style="color:var(--yellow)">attempts 3-way merge on entity body</td>
            </tr>
            <tr>
              <td>One deletes, one modifies</td>
              <td class="lose">silent data loss possible</td>
              <td class="win">modify/delete conflict reported</td>
            </tr>
            <tr>
              <td>JSON: different keys modified</td>
              <td class="lose">lines</td>
              <td class="win">entity-level, no false conflicts</td>
            </tr>
            <tr>
              <td>Python: two new functions added</td>
              <td class="lose">CONFLICT (same region)</td>
              <td class="win">auto-resolved</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- ═══ Architecture ═══ -->
    <section id="architecture">
      <h2>Architecture</h2>
      <p class="section-desc">Five crates in a Cargo workspace. Each can be used independently.</p>

      <div class="arch-layer" style="border-color: var(--green);">
        <div class="label" style="color: var(--green);">weave-core</div>
        <div class="desc">The merge algorithm. Takes three strings (base, ours, theirs) + file path, returns merged content + conflict list. Uses <code style="color:var(--cyan)">sem-core</code> for entity extraction and <code style="color:var(--cyan)">diffy</code> for line-level fallback.</div>
      </div>
      <div class="arch-arrow">&darr;</div>
      <div class="arch-layer" style="border-color: var(--blue);">
        <div class="label" style="color: var(--blue);">weave-driver</div>
        <div class="desc">Git merge driver binary. Git calls it with <code style="color:var(--cyan)">%O %A %B %L %P</code>. Reads three temp files, calls <code style="color:var(--cyan)">entity_merge()</code>, writes result to <code style="color:var(--cyan)">%A</code>. Exit 0 = clean, 1 = conflicts.</div>
      </div>
      <div class="arch-arrow">&darr;</div>
      <div class="arch-layer" style="border-color: var(--purple);">
        <div class="label" style="color: var(--purple);">weave-crdt</div>
        <div class="desc">Automerge-backed entity state. Advisory claims, agent tracking, conflict detection. Persisted at <code style="color:var(--cyan)">.weave/state.automerge</code>. Not committed to git &mdash; local coordination state.</div>
      </div>
      <div class="arch-arrow">&darr;</div>
      <div class="arch-layer" style="border-color: var(--cyan);">
        <div class="label" style="color: var(--cyan);">weave-mcp</div>
        <div class="desc">MCP server with 9 tools. stdio transport for Claude Desktop/CLI integration. Wraps weave-crdt and weave-core into callable agent tools.</div>
      </div>
      <div class="arch-arrow">&darr;</div>
      <div class="arch-layer" style="border-color: var(--orange);">
        <div class="label" style="color: var(--orange);">weave-cli</div>
        <div class="desc">Human-facing CLI. <code style="color:var(--cyan)">weave setup</code>, <code style="color:var(--cyan)">weave preview</code>, <code style="color:var(--cyan)">weave status</code>, <code style="color:var(--cyan)">weave claim</code>, <code style="color:var(--cyan)">weave release</code>.</div>
      </div>
    </section>

    <!-- ═══ CRDT ═══ -->
    <section id="crdt">
      <h2>CRDT state</h2>
      <p class="section-desc">
        CRDT stands for <strong style="color:var(--accent)">Conflict-free Replicated Data Type</strong> &mdash; a data structure that multiple agents can edit simultaneously without conflicts. Think of it like a Google Doc that always merges correctly.
      </p>

      <div class="concept-box" style="border-color: var(--purple);">
        <h4 style="color: var(--purple);">Why does weave need it?</h4>
        <p>The merge driver is <em>reactive</em> &mdash; it resolves conflicts after they happen. But if two agents are about to edit the same function, you want to know <em>before</em> they collide. The CRDT gives agents a shared "who's editing what" map. Agent A claims <code>processData</code>, Agent B sees the claim and picks a different function instead.</p>
      </div>

      <div class="concept-box" style="border-color: var(--yellow);">
        <h4 style="color: var(--yellow);">Advisory, not enforced</h4>
        <p>Claims are signals, not hard locks. If an agent ignores a claim and edits anyway, the merge still works &mdash; weave's merge driver handles it. This matches the optimistic concurrency model: trust agents to cooperate, handle it gracefully if they don't.</p>
      </div>

      <h3 style="font-size: 16px; color: var(--accent); margin: 32px 0 16px;">Document structure</h3>
      <p style="font-size: 13px; color: var(--dim); margin-bottom: 16px;">
        The state is an <a href="https://automerge.org" style="color:var(--purple)">Automerge</a> document saved to <code style="color:var(--cyan)">.weave/state.automerge</code>. It has three top-level maps:
      </p>

      <div class="state-doc">
<pre><span class="d">{</span>
  <span class="b">"entities"</span>: <span class="d">{</span>                       <span class="d">// every code entity weave knows about</span>
    <span class="c">"src/lib.ts::function::processData"</span>: <span class="d">{</span>
      <span class="b">"name"</span>: <span class="w">"processData"</span>,
      <span class="b">"type"</span>: <span class="w">"function"</span>,
      <span class="b">"file_path"</span>: <span class="w">"src/lib.ts"</span>,
      <span class="b">"content_hash"</span>: <span class="d">"a1b2c3..."</span>,
      <span class="b">"claimed_by"</span>: <span class="g">"agent-1"</span>,          <span class="d">// advisory lock</span>
      <span class="b">"claimed_at"</span>: <span class="y">1706745600000</span>,
      <span class="b">"last_modified_by"</span>: <span class="o">"agent-1"</span>,
      <span class="b">"version"</span>: <span class="y">3</span>
    <span class="d">}</span>
  <span class="d">}</span>,
  <span class="b">"agents"</span>: <span class="d">{</span>                         <span class="d">// registered agents</span>
    <span class="c">"agent-1"</span>: <span class="d">{</span>
      <span class="b">"name"</span>: <span class="w">"agent-1"</span>,
      <span class="b">"status"</span>: <span class="g">"active"</span>,
      <span class="b">"branch"</span>: <span class="w">"feature-auth"</span>,
      <span class="b">"last_seen"</span>: <span class="y">1706745600000</span>,
      <span class="b">"working_on"</span>: [<span class="c">"src/lib.ts::function::processData"</span>]
    <span class="d">}</span>
  <span class="d">}</span>,
  <span class="b">"operations"</span>: [<span class="d">...</span>]               <span class="d">// audit log of claim/release/modify</span>
<span class="d">}</span></pre>
      </div>

      <h3 style="font-size: 16px; color: var(--accent); margin: 32px 0 16px;">Agent coordination flow</h3>
      <div class="flow">
        <div class="flow-step">
          <div class="flow-num" style="border-color:var(--purple);color:var(--purple)">1</div>
          <div class="flow-content">
            <div class="title">Agent registers</div>
            <div class="desc">Calls <code style="color:var(--cyan)">weave_agent_register</code> with its ID and branch. Gets added to the agents map.</div>
          </div>
        </div>
        <div class="flow-connector"><div class="line"></div></div>
        <div class="flow-step">
          <div class="flow-num" style="border-color:var(--purple);color:var(--purple)">2</div>
          <div class="flow-content">
            <div class="title">Agent claims an entity</div>
            <div class="desc">Calls <code style="color:var(--cyan)">weave_claim_entity</code>. Gets back <span class="g">Claimed</span>, <span class="y">AlreadyOwnedBySelf</span>, or <span class="r">AlreadyClaimed { by }</span>.</div>
          </div>
        </div>
        <div class="flow-connector"><div class="line"></div></div>
        <div class="flow-step">
          <div class="flow-num" style="border-color:var(--purple);color:var(--purple)">3</div>
          <div class="flow-content">
            <div class="title">Agent edits the code</div>
            <div class="desc">Periodically calls <code style="color:var(--cyan)">weave_agent_heartbeat</code> with its working_on list. Other agents can check <code style="color:var(--cyan)">weave_who_is_editing</code> before starting work.</div>
          </div>
        </div>
        <div class="flow-connector"><div class="line"></div></div>
        <div class="flow-step">
          <div class="flow-num" style="border-color:var(--purple);color:var(--purple)">4</div>
          <div class="flow-content">
            <div class="title">Agent releases the claim</div>
            <div class="desc">Calls <code style="color:var(--cyan)">weave_release_entity</code> when done. If an agent crashes, <code style="color:var(--cyan)">cleanup_stale_agents</code> releases its claims after a timeout.</div>
          </div>
        </div>
      </div>

      <h3 style="font-size: 16px; color: var(--accent); margin: 32px 0 16px;">Core operations</h3>
      <table>
        <thead>
          <tr><th>Operation</th><th>What it does</th></tr>
        </thead>
        <tbody>
          <tr><td><code style="color:var(--cyan)">claim_entity</code></td><td>Set advisory lock on an entity for an agent</td></tr>
          <tr><td><code style="color:var(--cyan)">release_entity</code></td><td>Remove the lock (only the owner can release)</td></tr>
          <tr><td><code style="color:var(--cyan)">record_modification</code></td><td>Mark that an agent changed an entity, bump version</td></tr>
          <tr><td><code style="color:var(--cyan)">detect_potential_conflicts</code></td><td>Find entities being worked on by multiple agents</td></tr>
          <tr><td><code style="color:var(--cyan)">register_agent</code></td><td>Add an agent to the state with name and branch</td></tr>
          <tr><td><code style="color:var(--cyan)">agent_heartbeat</code></td><td>Keep-alive + update working_on list</td></tr>
          <tr><td><code style="color:var(--cyan)">cleanup_stale_agents</code></td><td>Release claims from agents that stopped heartbeating</td></tr>
          <tr><td><code style="color:var(--cyan)">sync_from_files</code></td><td>Extract entities from working tree files into CRDT state</td></tr>
        </tbody>
      </table>
    </section>

    <!-- ═══ MCP Server ═══ -->
    <section id="mcp">
      <h2>MCP server</h2>
      <p class="section-desc">
        <a href="https://modelcontextprotocol.io" style="color:var(--cyan)">MCP</a> (Model Context Protocol) lets AI agents call tools. weave-mcp exposes 9 tools over stdio transport. Add it to Claude Desktop or any MCP-compatible client.
      </p>

      <div class="terminal">
        <div class="terminal-bar">
          <div class="terminal-dot"></div>
          <div class="terminal-dot"></div>
          <div class="terminal-dot"></div>
          <div class="terminal-title">claude_desktop_config.json</div>
        </div>
        <div class="terminal-body">
<pre><span class="d">{</span>
  <span class="b">"mcpServers"</span>: <span class="d">{</span>
    <span class="b">"weave"</span>: <span class="d">{</span>
      <span class="b">"command"</span>: <span class="g">"weave-mcp"</span>,
      <span class="b">"args"</span>: []
    <span class="d">}</span>
  <span class="d">}</span>
<span class="d">}</span></pre>
        </div>
      </div>

      <h3 style="font-size: 16px; color: var(--accent); margin: 32px 0 16px;">Tools</h3>

      <div class="tool-grid">
        <div class="tool-card" style="border-color: var(--green);">
          <div class="tool-name">weave_extract_entities</div>
          <div class="tool-desc">List all entities in a file &mdash; names, types, line ranges. Input: <code>{file_path}</code></div>
        </div>
        <div class="tool-card" style="border-color: var(--purple);">
          <div class="tool-name">weave_claim_entity</div>
          <div class="tool-desc">Claim an entity before editing. Advisory lock. Input: <code>{agent_id, file_path, entity_name}</code></div>
        </div>
        <div class="tool-card" style="border-color: var(--purple);">
          <div class="tool-name">weave_release_entity</div>
          <div class="tool-desc">Release claim after done editing. Input: <code>{agent_id, file_path, entity_name}</code></div>
        </div>
        <div class="tool-card" style="border-color: var(--blue);">
          <div class="tool-name">weave_status</div>
          <div class="tool-desc">Entity list with claim and modification status. Input: <code>{file_path}</code></div>
        </div>
        <div class="tool-card" style="border-color: var(--blue);">
          <div class="tool-name">weave_who_is_editing</div>
          <div class="tool-desc">Check if anyone is editing a specific entity. Input: <code>{file_path, entity_name}</code></div>
        </div>
        <div class="tool-card" style="border-color: var(--red);">
          <div class="tool-name">weave_potential_conflicts</div>
          <div class="tool-desc">Entities being edited by multiple agents. Input: <code>{agent_id?}</code></div>
        </div>
        <div class="tool-card" style="border-color: var(--green);">
          <div class="tool-name">weave_preview_merge</div>
          <div class="tool-desc">Dry-run merge analysis between branches. Input: <code>{base_branch, target_branch, file_path?}</code></div>
        </div>
        <div class="tool-card" style="border-color: var(--orange);">
          <div class="tool-name">weave_agent_register</div>
          <div class="tool-desc">Register agent in coordination state. Input: <code>{agent_id, branch}</code></div>
        </div>
        <div class="tool-card" style="border-color: var(--orange);">
          <div class="tool-name">weave_agent_heartbeat</div>
          <div class="tool-desc">Keep-alive + update working state. Input: <code>{agent_id, working_on}</code></div>
        </div>
      </div>

      <h3 style="font-size: 16px; color: var(--accent); margin: 32px 0 16px;">Example: agent workflow</h3>
      <div class="terminal">
        <div class="terminal-bar">
          <div class="terminal-dot"></div>
          <div class="terminal-dot"></div>
          <div class="terminal-dot"></div>
          <div class="terminal-title">agent calls via MCP</div>
        </div>
        <div class="terminal-body">
<pre><span class="d">// Agent starts up</span>
<span class="p">weave_agent_register</span>(<span class="d">{</span> <span class="b">agent_id</span>: <span class="g">"claude-1"</span>, <span class="b">branch</span>: <span class="g">"feature-auth"</span> <span class="d">}</span>)

<span class="d">// Check what's in the file</span>
<span class="p">weave_extract_entities</span>(<span class="d">{</span> <span class="b">file_path</span>: <span class="g">"src/auth.ts"</span> <span class="d">}</span>)
<span class="d">// &rarr; [{name: "validateToken", type: "function", ...},</span>
<span class="d">//     {name: "authenticate", type: "function", ...}]</span>

<span class="d">// Claim before editing</span>
<span class="p">weave_claim_entity</span>(<span class="d">{</span> <span class="b">agent_id</span>: <span class="g">"claude-1"</span>, <span class="b">file_path</span>: <span class="g">"src/auth.ts"</span>, <span class="b">entity_name</span>: <span class="g">"validateToken"</span> <span class="d">}</span>)
<span class="d">// &rarr; "Claimed"</span>

<span class="d">// ... agent edits the function ...</span>

<span class="d">// Release when done</span>
<span class="p">weave_release_entity</span>(<span class="d">{</span> <span class="b">agent_id</span>: <span class="g">"claude-1"</span>, <span class="b">file_path</span>: <span class="g">"src/auth.ts"</span>, <span class="b">entity_name</span>: <span class="g">"validateToken"</span> <span class="d">}</span>)
<span class="d">// &rarr; "Released successfully"</span></pre>
        </div>
      </div>
    </section>

    <!-- ═══ Commands ═══ -->
    <section id="commands">
      <h2>CLI commands</h2>
      <p class="section-desc">The <code style="color:var(--cyan)">weave</code> CLI wraps all functionality for human use.</p>

      <div class="cmd-doc">
        <div class="cmd-doc-header">
          <span class="cmd-doc-name">weave setup</span>
          <span class="cmd-doc-desc">Configure current git repo to use weave as merge driver</span>
        </div>
        <div class="cmd-doc-flags">
          <div class="flag"><code>--driver &lt;path&gt;</code> <span>Path to weave-driver binary (auto-detected if omitted)</span></div>
        </div>
      </div>

      <div class="cmd-doc">
        <div class="cmd-doc-header">
          <span class="cmd-doc-name">weave preview &lt;branch&gt;</span>
          <span class="cmd-doc-desc">Preview what a merge would look like without actually merging</span>
        </div>
        <div class="cmd-doc-flags">
          <div class="flag"><code>--file &lt;path&gt;</code> <span>Preview a specific file only</span></div>
        </div>
      </div>

      <div class="cmd-doc">
        <div class="cmd-doc-header">
          <span class="cmd-doc-name">weave status</span>
          <span class="cmd-doc-desc">Show entity and agent state from CRDT</span>
        </div>
        <div class="cmd-doc-flags">
          <div class="flag"><code>--file &lt;path&gt;</code> <span>Show entities for a specific file</span></div>
          <div class="flag"><code>--agent &lt;id&gt;</code> <span>Show status for a specific agent</span></div>
        </div>
      </div>

      <div class="cmd-doc">
        <div class="cmd-doc-header">
          <span class="cmd-doc-name">weave claim &lt;agent&gt; &lt;file&gt; &lt;entity&gt;</span>
          <span class="cmd-doc-desc">Claim an entity before editing</span>
        </div>
      </div>

      <div class="cmd-doc">
        <div class="cmd-doc-header">
          <span class="cmd-doc-name">weave release &lt;agent&gt; &lt;file&gt; &lt;entity&gt;</span>
          <span class="cmd-doc-desc">Release a previously claimed entity</span>
        </div>
      </div>
    </section>

    <!-- ═══ Supported Languages ═══ -->
    <section>
      <h2>Supported languages</h2>
      <p class="section-desc">Entity extraction powered by <a href="https://github.com/Ataraxy-Labs/sem" style="color:var(--green)">sem-core</a> and tree-sitter.</p>
      <table>
        <thead>
          <tr><th>Language</th><th>Extensions</th><th>Entities</th></tr>
        </thead>
        <tbody>
          <tr><td>TypeScript</td><td>.ts .tsx</td><td>functions, classes, interfaces, types, enums</td></tr>
          <tr><td>JavaScript</td><td>.js .jsx .mjs .cjs</td><td>functions, classes, variables</td></tr>
          <tr><td>Python</td><td>.py</td><td>functions, classes, decorators</td></tr>
          <tr><td>Go</td><td>.go</td><td>functions, methods, types</td></tr>
          <tr><td>Rust</td><td>.rs</td><td>functions, structs, enums, impls, traits</td></tr>
          <tr><td>JSON</td><td>.json</td><td>properties, objects</td></tr>
          <tr><td>YAML</td><td>.yml .yaml</td><td>sections, properties</td></tr>
          <tr><td>TOML</td><td>.toml</td><td>sections, properties</td></tr>
          <tr><td>CSV</td><td>.csv .tsv</td><td>rows</td></tr>
          <tr><td>Markdown</td><td>.md .mdx</td><td>heading-based sections</td></tr>
        </tbody>
      </table>
    </section>

    <!-- ═══ Quick Start ═══ -->
    <section>
      <h2>Quick start</h2>
      <p class="section-desc">Get weave running in your repo in 30 seconds.</p>

      <div class="terminal">
        <div class="terminal-bar">
          <div class="terminal-dot"></div>
          <div class="terminal-dot"></div>
          <div class="terminal-dot"></div>
          <div class="terminal-title">~/my-project</div>
        </div>
        <div class="terminal-body">
<pre><span class="d"># Install</span>
<span class="cmd">$ cargo install --git https://github.com/Ataraxy-Labs/weave weave-cli</span>
<span class="cmd">$ cargo install --git https://github.com/Ataraxy-Labs/weave weave-driver</span>

<span class="d"># Configure your repo</span>
<span class="cmd">$ cd my-project</span>
<span class="cmd">$ weave setup</span>
<span class="g">&#10003;</span> Created .gitattributes with weave merge driver rules
<span class="g">&#10003;</span> Configured git merge driver 'weave'

<span class="d"># Preview a merge before doing it</span>
<span class="cmd">$ weave preview feature-branch</span>
  src/auth.ts &mdash; <span class="g">auto-resolved</span>
    2 entities matched, 2 modified, 0 conflicts
  src/config.json &mdash; <span class="g">auto-resolved</span>
    1 entity matched, 1 modified, 0 conflicts

<span class="g">&#10003;</span> Merge would be clean (2 file(s) auto-resolved by weave)

<span class="d"># Now git merge uses weave automatically</span>
<span class="cmd">$ git merge feature-branch</span>
<span class="g">Merge made by the 'ort' strategy.</span></pre>
        </div>
      </div>

      <h3 style="font-size: 16px; color: var(--accent); margin: 32px 0 16px;">For AI agents (MCP)</h3>

      <div class="terminal">
        <div class="terminal-bar">
          <div class="terminal-dot"></div>
          <div class="terminal-dot"></div>
          <div class="terminal-dot"></div>
          <div class="terminal-title">install MCP server</div>
        </div>
        <div class="terminal-body">
<pre><span class="d"># Install the MCP server binary</span>
<span class="cmd">$ cargo install --git https://github.com/Ataraxy-Labs/weave weave-mcp</span>

<span class="d"># Add to Claude Desktop config (~/.config/claude/claude_desktop_config.json)</span>
<span class="d">{</span>
  <span class="b">"mcpServers"</span>: <span class="d">{</span>
    <span class="b">"weave"</span>: <span class="d">{</span> <span class="b">"command"</span>: <span class="g">"weave-mcp"</span> <span class="d">}</span>
  <span class="d">}</span>
<span class="d">}</span>

<span class="d"># Agents now have access to all 9 weave tools</span></pre>
        </div>
      </div>
    </section>

    <footer>
      <p>Built by <a href="https://ataraxy-labs.com">Ataraxy Labs</a></p>
    </footer>
  </div>

  <script>
    function copyCmd(el, cmd) {
      navigator.clipboard.writeText(cmd);
      let copied = el.querySelector('.copied');
      if (copied) {
        copied.classList.add('show');
        setTimeout(() => copied.classList.remove('show'), 1500);
      }
    }
  </script>
</body>
</html>
